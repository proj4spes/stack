{
    "version": 3,
    "terraform_version": "0.10.8",
    "serial": 2,
    "lineage": "c122978a-44a9-42ea-9107-0439d3be5787",
    "modules": [
        {
            "path": [
                "root"
            ],
            "outputs": {
                "availability_zones": {
                    "sensitive": false,
                    "type": "list",
                    "value": []
                },
                "cluster": {
                    "sensitive": false,
                    "type": "string",
                    "value": "seg"
                },
                "domain_name": {
                    "sensitive": false,
                    "type": "string",
                    "value": "stack.local"
                },
                "environment": {
                    "sensitive": false,
                    "type": "string",
                    "value": "prod"
                },
                "external_subnets": {
                    "sensitive": false,
                    "type": "list",
                    "value": []
                },
                "iam_role": {
                    "sensitive": false,
                    "type": "string",
                    "value": "arn:aws:iam::376128762854:role/ecs-role-seg-prod"
                },
                "iam_role_default_ecs_role_id": {
                    "sensitive": false,
                    "type": "string",
                    "value": "ecs-role-seg-prod"
                },
                "internal_route_tables": {
                    "sensitive": false,
                    "type": "string",
                    "value": ""
                },
                "internal_subnets": {
                    "sensitive": false,
                    "type": "list",
                    "value": []
                },
                "name": {
                    "sensitive": false,
                    "type": "string",
                    "value": "seg"
                },
                "region": {
                    "sensitive": false,
                    "type": "string",
                    "value": "eu-west-1"
                },
                "vpc_id": {
                    "sensitive": false,
                    "type": "string",
                    "value": "vpc-f4c8a28c"
                },
                "vpc_security_group": {
                    "sensitive": false,
                    "type": "string",
                    "value": "sg-fdd6be88"
                }
            },
            "resources": {
                "data.aws_availability_zones.available": {
                    "type": "aws_availability_zones",
                    "depends_on": [],
                    "primary": {
                        "id": "2017-12-04 00:09:09.814169276 +0000 UTC",
                        "attributes": {
                            "id": "2017-12-04 00:09:09.814169276 +0000 UTC",
                            "names.#": "6",
                            "names.0": "us-east-1a",
                            "names.1": "us-east-1b",
                            "names.2": "us-east-1c",
                            "names.3": "us-east-1d",
                            "names.4": "us-east-1e",
                            "names.5": "us-east-1f"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                }
            },
            "depends_on": []
        },
        {
            "path": [
                "root",
                "bastion"
            ],
            "outputs": {},
            "resources": {},
            "depends_on": []
        },
        {
            "path": [
                "root",
                "defaults"
            ],
            "outputs": {
                "domain_name_servers": {
                    "sensitive": false,
                    "type": "string",
                    "value": "10.30.0.2"
                },
                "ecs_ami": {
                    "sensitive": false,
                    "type": "string",
                    "value": "ami-014ae578"
                },
                "s3_logs_account_id": {
                    "sensitive": false,
                    "type": "string",
                    "value": "156460612806"
                }
            },
            "resources": {},
            "depends_on": []
        },
        {
            "path": [
                "root",
                "dhcp"
            ],
            "outputs": {},
            "resources": {
                "aws_vpc_dhcp_options.dns_resolver": {
                    "type": "aws_vpc_dhcp_options",
                    "depends_on": [],
                    "primary": {
                        "id": "dopt-bf7926c6",
                        "attributes": {
                            "domain_name": "stack.local",
                            "domain_name_servers.#": "1",
                            "domain_name_servers.0": "10.30.0.2",
                            "id": "dopt-bf7926c6"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                }
            },
            "depends_on": []
        },
        {
            "path": [
                "root",
                "dns"
            ],
            "outputs": {
                "name": {
                    "sensitive": false,
                    "type": "string",
                    "value": "stack.local"
                }
            },
            "resources": {},
            "depends_on": []
        },
        {
            "path": [
                "root",
                "ecs_cluster"
            ],
            "outputs": {
                "name": {
                    "sensitive": false,
                    "type": "string",
                    "value": "seg"
                }
            },
            "resources": {
                "aws_ecs_cluster.main": {
                    "type": "aws_ecs_cluster",
                    "depends_on": [],
                    "primary": {
                        "id": "arn:aws:ecs:us-east-1:376128762854:cluster/seg",
                        "attributes": {
                            "id": "arn:aws:ecs:us-east-1:376128762854:cluster/seg",
                            "name": "seg"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "data.template_cloudinit_config.cloud_config": {
                    "type": "template_cloudinit_config",
                    "depends_on": [
                        "data.template_file.ecs_cloud_config"
                    ],
                    "primary": {
                        "id": "943952291",
                        "attributes": {
                            "base64_encode": "false",
                            "gzip": "false",
                            "id": "943952291",
                            "part.#": "2",
                            "part.0.content": "#cloud-config\nbootcmd:\n  - echo 'SERVER_ENVIRONMENT=prod' \u003e\u003e /etc/environment\n  - echo 'SERVER_GROUP=seg' \u003e\u003e /etc/environment\n  - echo 'SERVER_REGION=eu-west-1' \u003e\u003e /etc/environment\n\n  - mkdir -p /etc/ecs\n  - echo 'ECS_CLUSTER=seg' \u003e\u003e /etc/ecs/ecs.config\n  - echo 'ECS_ENGINE_AUTH_TYPE=' \u003e\u003e /etc/ecs/ecs.config\n  - \u003e\n    echo 'ECS_ENGINE_AUTH_DATA=' \u003e\u003e /etc/ecs/ecs.config\n",
                            "part.0.content_type": "text/cloud-config",
                            "part.0.filename": "",
                            "part.0.merge_type": "",
                            "part.1.content": "",
                            "part.1.content_type": "text/cloud-config",
                            "part.1.filename": "",
                            "part.1.merge_type": "",
                            "rendered": "Content-Type: multipart/mixed; boundary=\"MIMEBOUNDARY\"\nMIME-Version: 1.0\r\n\r\n--MIMEBOUNDARY\r\nContent-Transfer-Encoding: 7bit\r\nContent-Type: text/cloud-config\r\nMime-Version: 1.0\r\n\r\n#cloud-config\nbootcmd:\n  - echo 'SERVER_ENVIRONMENT=prod' \u003e\u003e /etc/environment\n  - echo 'SERVER_GROUP=seg' \u003e\u003e /etc/environment\n  - echo 'SERVER_REGION=eu-west-1' \u003e\u003e /etc/environment\n\n  - mkdir -p /etc/ecs\n  - echo 'ECS_CLUSTER=seg' \u003e\u003e /etc/ecs/ecs.config\n  - echo 'ECS_ENGINE_AUTH_TYPE=' \u003e\u003e /etc/ecs/ecs.config\n  - \u003e\n    echo 'ECS_ENGINE_AUTH_DATA=' \u003e\u003e /etc/ecs/ecs.config\n\r\n--MIMEBOUNDARY\r\nContent-Transfer-Encoding: 7bit\r\nContent-Type: text/cloud-config\r\nMime-Version: 1.0\r\n\r\n\r\n--MIMEBOUNDARY--\r\n"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "data.template_file.ecs_cloud_config": {
                    "type": "template_file",
                    "depends_on": [],
                    "primary": {
                        "id": "6e23590c49f79273ca7dbcf1cb1e490ad6dba5b9470459517fceb96c72dc03c8",
                        "attributes": {
                            "id": "6e23590c49f79273ca7dbcf1cb1e490ad6dba5b9470459517fceb96c72dc03c8",
                            "rendered": "#cloud-config\nbootcmd:\n  - echo 'SERVER_ENVIRONMENT=prod' \u003e\u003e /etc/environment\n  - echo 'SERVER_GROUP=seg' \u003e\u003e /etc/environment\n  - echo 'SERVER_REGION=eu-west-1' \u003e\u003e /etc/environment\n\n  - mkdir -p /etc/ecs\n  - echo 'ECS_CLUSTER=seg' \u003e\u003e /etc/ecs/ecs.config\n  - echo 'ECS_ENGINE_AUTH_TYPE=' \u003e\u003e /etc/ecs/ecs.config\n  - \u003e\n    echo 'ECS_ENGINE_AUTH_DATA=' \u003e\u003e /etc/ecs/ecs.config\n",
                            "template": "#cloud-config\nbootcmd:\n  - echo 'SERVER_ENVIRONMENT=${environment}' \u003e\u003e /etc/environment\n  - echo 'SERVER_GROUP=${name}' \u003e\u003e /etc/environment\n  - echo 'SERVER_REGION=${region}' \u003e\u003e /etc/environment\n\n  - mkdir -p /etc/ecs\n  - echo 'ECS_CLUSTER=${name}' \u003e\u003e /etc/ecs/ecs.config\n  - echo 'ECS_ENGINE_AUTH_TYPE=${docker_auth_type}' \u003e\u003e /etc/ecs/ecs.config\n  - \u003e\n    echo 'ECS_ENGINE_AUTH_DATA=${docker_auth_data}' \u003e\u003e /etc/ecs/ecs.config\n",
                            "vars.%": "5",
                            "vars.docker_auth_data": "",
                            "vars.docker_auth_type": "",
                            "vars.environment": "prod",
                            "vars.name": "seg",
                            "vars.region": "eu-west-1"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                }
            },
            "depends_on": []
        },
        {
            "path": [
                "root",
                "iam_role"
            ],
            "outputs": {
                "arn": {
                    "sensitive": false,
                    "type": "string",
                    "value": "arn:aws:iam::376128762854:role/ecs-role-seg-prod"
                },
                "default_ecs_role_id": {
                    "sensitive": false,
                    "type": "string",
                    "value": "ecs-role-seg-prod"
                }
            },
            "resources": {
                "aws_iam_role.default_ecs_role": {
                    "type": "aws_iam_role",
                    "depends_on": [],
                    "primary": {
                        "id": "ecs-role-seg-prod",
                        "attributes": {
                            "arn": "arn:aws:iam::376128762854:role/ecs-role-seg-prod",
                            "assume_role_policy": "{\"Version\":\"2008-10-17\",\"Statement\":[{\"Effect\":\"Allow\",\"Principal\":{\"Service\":[\"ecs.amazonaws.com\",\"ec2.amazonaws.com\"]},\"Action\":\"sts:AssumeRole\"}]}",
                            "create_date": "2017-12-04T00:09:21Z",
                            "force_detach_policies": "false",
                            "id": "ecs-role-seg-prod",
                            "name": "ecs-role-seg-prod",
                            "path": "/",
                            "unique_id": "AROAJU3INONU5Q7VCYD4S"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                }
            },
            "depends_on": []
        },
        {
            "path": [
                "root",
                "s3_logs"
            ],
            "outputs": {},
            "resources": {
                "data.template_file.policy": {
                    "type": "template_file",
                    "depends_on": [],
                    "primary": {
                        "id": "89adda17e806c2800618375c160003b5b1db919d84cf6d08fa7b9518c692da8f",
                        "attributes": {
                            "id": "89adda17e806c2800618375c160003b5b1db919d84cf6d08fa7b9518c692da8f",
                            "rendered": "{\n  \"Id\": \"log-bucket-policy\",\n  \"Statement\": [\n    {\n      \"Action\": \"s3:PutObject\",\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"AWS\": \"arn:aws:iam::156460612806:root\"\n      },\n      \"Resource\": \"arn:aws:s3:::seg-prod-logs/*\",\n      \"Sid\": \"log-bucket-policy\"\n    }\n  ],\n  \"Version\": \"2012-10-17\"\n}\n",
                            "template": "{\n  \"Id\": \"log-bucket-policy\",\n  \"Statement\": [\n    {\n      \"Action\": \"s3:PutObject\",\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"AWS\": \"arn:aws:iam::${account_id}:root\"\n      },\n      \"Resource\": \"arn:aws:s3:::${bucket}/*\",\n      \"Sid\": \"log-bucket-policy\"\n    }\n  ],\n  \"Version\": \"2012-10-17\"\n}\n",
                            "vars.%": "2",
                            "vars.account_id": "156460612806",
                            "vars.bucket": "seg-prod-logs"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                }
            },
            "depends_on": []
        },
        {
            "path": [
                "root",
                "security_groups"
            ],
            "outputs": {},
            "resources": {},
            "depends_on": []
        },
        {
            "path": [
                "root",
                "vpc"
            ],
            "outputs": {
                "availability_zones": {
                    "sensitive": false,
                    "type": "list",
                    "value": []
                },
                "cidr_block": {
                    "sensitive": false,
                    "type": "string",
                    "value": "10.30.0.0/16"
                },
                "external_subnets": {
                    "sensitive": false,
                    "type": "list",
                    "value": []
                },
                "id": {
                    "sensitive": false,
                    "type": "string",
                    "value": "vpc-f4c8a28c"
                },
                "internal_nat_ips": {
                    "sensitive": false,
                    "type": "list",
                    "value": []
                },
                "internal_rtb_id": {
                    "sensitive": false,
                    "type": "string",
                    "value": ""
                },
                "internal_subnets": {
                    "sensitive": false,
                    "type": "list",
                    "value": []
                },
                "security_group": {
                    "sensitive": false,
                    "type": "string",
                    "value": "sg-fdd6be88"
                }
            },
            "resources": {
                "aws_vpc.main": {
                    "type": "aws_vpc",
                    "depends_on": [],
                    "primary": {
                        "id": "vpc-f4c8a28c",
                        "attributes": {
                            "assign_generated_ipv6_cidr_block": "false",
                            "cidr_block": "10.30.0.0/16",
                            "default_network_acl_id": "acl-5f669124",
                            "default_route_table_id": "rtb-a79985dd",
                            "default_security_group_id": "sg-fdd6be88",
                            "dhcp_options_id": "dopt-461ae020",
                            "enable_classiclink": "false",
                            "enable_classiclink_dns_support": "false",
                            "enable_dns_hostnames": "true",
                            "enable_dns_support": "true",
                            "id": "vpc-f4c8a28c",
                            "instance_tenancy": "default",
                            "main_route_table_id": "rtb-a79985dd",
                            "tags.%": "2",
                            "tags.Environment": "prod",
                            "tags.Name": "seg"
                        },
                        "meta": {
                            "schema_version": "1"
                        },
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                },
                "data.aws_ami.nat_ami": {
                    "type": "aws_ami",
                    "depends_on": [],
                    "primary": {
                        "id": "ami-25ef665f",
                        "attributes": {
                            "architecture": "x86_64",
                            "block_device_mappings.#": "1",
                            "block_device_mappings.3607311014.device_name": "/dev/xvda",
                            "block_device_mappings.3607311014.ebs.%": "6",
                            "block_device_mappings.3607311014.ebs.delete_on_termination": "true",
                            "block_device_mappings.3607311014.ebs.encrypted": "false",
                            "block_device_mappings.3607311014.ebs.iops": "0",
                            "block_device_mappings.3607311014.ebs.snapshot_id": "snap-0020d7c3e50526495",
                            "block_device_mappings.3607311014.ebs.volume_size": "8",
                            "block_device_mappings.3607311014.ebs.volume_type": "standard",
                            "block_device_mappings.3607311014.no_device": "",
                            "block_device_mappings.3607311014.virtual_name": "",
                            "creation_date": "2017-11-20T22:28:49.000Z",
                            "description": "Amazon Linux AMI 2017.09.1.20171120 x86_64 VPC NAT HVM EBS",
                            "filter.#": "2",
                            "filter.3298344342.name": "name",
                            "filter.3298344342.values.#": "1",
                            "filter.3298344342.values.0": "amzn-ami-vpc-nat*",
                            "filter.574890044.name": "owner-alias",
                            "filter.574890044.values.#": "1",
                            "filter.574890044.values.0": "amazon",
                            "hypervisor": "xen",
                            "id": "ami-25ef665f",
                            "image_id": "ami-25ef665f",
                            "image_location": "amazon/amzn-ami-vpc-nat-hvm-2017.09.1.20171120-x86_64-ebs",
                            "image_owner_alias": "amazon",
                            "image_type": "machine",
                            "most_recent": "true",
                            "name": "amzn-ami-vpc-nat-hvm-2017.09.1.20171120-x86_64-ebs",
                            "owner_id": "137112412989",
                            "product_codes.#": "0",
                            "public": "true",
                            "root_device_name": "/dev/xvda",
                            "root_device_type": "ebs",
                            "root_snapshot_id": "snap-0020d7c3e50526495",
                            "sriov_net_support": "simple",
                            "state": "available",
                            "state_reason.%": "2",
                            "state_reason.code": "UNSET",
                            "state_reason.message": "UNSET",
                            "tags.%": "0",
                            "virtualization_type": "hvm"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": ""
                }
            },
            "depends_on": []
        },
        {
            "path": [
                "root",
                "bastion",
                "ami"
            ],
            "outputs": {
                "ami_id": {
                    "sensitive": false,
                    "type": "string",
                    "value": "ami-30628649"
                }
            },
            "resources": {},
            "depends_on": []
        },
        {
            "path": [
                "root",
                "bastion",
                "ami",
                "ami"
            ],
            "outputs": {
                "ami_id": {
                    "sensitive": false,
                    "type": "string",
                    "value": "ami-30628649"
                }
            },
            "resources": {},
            "depends_on": []
        },
        {
            "path": [
                "root",
                "bastion",
                "ami",
                "virttype"
            ],
            "outputs": {
                "prefer_hvm": {
                    "sensitive": false,
                    "type": "string",
                    "value": "hvm"
                },
                "prefer_pv": {
                    "sensitive": false,
                    "type": "string",
                    "value": "hvm"
                }
            },
            "resources": {},
            "depends_on": []
        }
    ]
}
